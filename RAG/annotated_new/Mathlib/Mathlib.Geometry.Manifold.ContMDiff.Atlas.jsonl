{"name":"contMDiff_model","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœÂ³ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœÂ² : NormedAddCommGroup E\ninstâœÂ¹ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nn : WithTop ENat\nâŠ¢ ContMDiff I (modelWithCornersSelf ğ•œ E) n â†‘I","decl":"theorem contMDiff_model : ContMDiff I ğ“˜(ğ•œ, E) n I := by\n  intro x\n  refine contMDiffAt_iff.mpr âŸ¨I.continuousAt, ?_âŸ©\n  simp only [mfld_simps]\n  refine contDiffWithinAt_id.congr_of_eventuallyEq ?_ ?_\n  Â· exact Filter.eventuallyEq_of_mem self_mem_nhdsWithin fun xâ‚‚ => I.right_inv\n  simp_rw [Function.comp_apply, I.left_inv, Function.id_def]\n\n"}
{"name":"contMDiffOn_model_symm","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœÂ³ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœÂ² : NormedAddCommGroup E\ninstâœÂ¹ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nn : WithTop ENat\nâŠ¢ ContMDiffOn (modelWithCornersSelf ğ•œ E) I n (â†‘I.symm) (Set.range â†‘I)","decl":"theorem contMDiffOn_model_symm : ContMDiffOn ğ“˜(ğ•œ, E) I n I.symm (range I) := by\n  rw [contMDiffOn_iff]\n  refine âŸ¨I.continuousOn_symm, fun x y => ?_âŸ©\n  simp only [mfld_simps]\n  exact contDiffOn_id.congr fun x' => I.right_inv\n\n"}
{"name":"contMDiffOn_of_mem_maximalAtlas","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\ne : PartialHomeomorph M H\nh : Membership.mem (IsManifold.maximalAtlas I n M) e\nâŠ¢ ContMDiffOn I I n (â†‘e) e.source","decl":"/-- An atlas member is `C^n` for any `n`. -/\ntheorem contMDiffOn_of_mem_maximalAtlas (h : e âˆˆ maximalAtlas I n M) :\n    ContMDiffOn I I n e e.source :=\n  (contDiffWithinAt_localInvariantProp n).liftPropOn_of_mem_maximalAtlas\n    contDiffWithinAtProp_id h\n\n"}
{"name":"contMDiffOn_symm_of_mem_maximalAtlas","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\ne : PartialHomeomorph M H\nh : Membership.mem (IsManifold.maximalAtlas I n M) e\nâŠ¢ ContMDiffOn I I n (â†‘e.symm) e.target","decl":"/-- The inverse of an atlas member is `C^n` for any `n`. -/\ntheorem contMDiffOn_symm_of_mem_maximalAtlas (h : e âˆˆ maximalAtlas I n M) :\n    ContMDiffOn I I n e.symm e.target :=\n  (contDiffWithinAt_localInvariantProp n).liftPropOn_symm_of_mem_maximalAtlas\n      contDiffWithinAtProp_id h\n\n"}
{"name":"contMDiffAt_of_mem_maximalAtlas","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\ne : PartialHomeomorph M H\nx : M\nh : Membership.mem (IsManifold.maximalAtlas I n M) e\nhx : Membership.mem e.source x\nâŠ¢ ContMDiffAt I I n (â†‘e) x","decl":"theorem contMDiffAt_of_mem_maximalAtlas (h : e âˆˆ maximalAtlas I n M) (hx : x âˆˆ e.source) :\n    ContMDiffAt I I n e x :=\n  (contMDiffOn_of_mem_maximalAtlas h).contMDiffAt <| e.open_source.mem_nhds hx\n\n"}
{"name":"contMDiffAt_symm_of_mem_maximalAtlas","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\ne : PartialHomeomorph M H\nx : H\nh : Membership.mem (IsManifold.maximalAtlas I n M) e\nhx : Membership.mem e.target x\nâŠ¢ ContMDiffAt I I n (â†‘e.symm) x","decl":"theorem contMDiffAt_symm_of_mem_maximalAtlas {x : H} (h : e âˆˆ maximalAtlas I n M)\n    (hx : x âˆˆ e.target) : ContMDiffAt I I n e.symm x :=\n  (contMDiffOn_symm_of_mem_maximalAtlas h).contMDiffAt <| e.open_target.mem_nhds hx\n\n"}
{"name":"contMDiffOn_chart","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\nx : M\nâŠ¢ ContMDiffOn I I n (â†‘(chartAt H x)) (chartAt H x).source","decl":"theorem contMDiffOn_chart : ContMDiffOn I I n (chartAt H x) (chartAt H x).source :=\n  contMDiffOn_of_mem_maximalAtlas <| chart_mem_maximalAtlas x\n\n"}
{"name":"contMDiffOn_chart_symm","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\nx : M\nâŠ¢ ContMDiffOn I I n (â†‘(chartAt H x).symm) (chartAt H x).target","decl":"theorem contMDiffOn_chart_symm : ContMDiffOn I I n (chartAt H x).symm (chartAt H x).target :=\n  contMDiffOn_symm_of_mem_maximalAtlas <| chart_mem_maximalAtlas x\n\n"}
{"name":"contMDiffAt_extend","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\ne : PartialHomeomorph M H\nx : M\nhe : Membership.mem (IsManifold.maximalAtlas I n M) e\nhx : Membership.mem e.source x\nâŠ¢ ContMDiffAt I (modelWithCornersSelf ğ•œ E) n (â†‘(e.extend I)) x","decl":"theorem contMDiffAt_extend {x : M} (he : e âˆˆ maximalAtlas I n M) (hx : x âˆˆ e.source) :\n    ContMDiffAt I ğ“˜(ğ•œ, E) n (e.extend I) x :=\n  (contMDiff_model _).comp x <| contMDiffAt_of_mem_maximalAtlas he hx\n\n"}
{"name":"contMDiffAt_extChartAt'","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\nx x' : M\nh : Membership.mem (chartAt H x).source x'\nâŠ¢ ContMDiffAt I (modelWithCornersSelf ğ•œ E) n (â†‘(extChartAt I x)) x'","decl":"theorem contMDiffAt_extChartAt' {x' : M} (h : x' âˆˆ (chartAt H x).source) :\n    ContMDiffAt I ğ“˜(ğ•œ, E) n (extChartAt I x) x' :=\n  contMDiffAt_extend (chart_mem_maximalAtlas x) h\n\n"}
{"name":"contMDiffAt_extChartAt","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\nx : M\nâŠ¢ ContMDiffAt I (modelWithCornersSelf ğ•œ E) n (â†‘(extChartAt I x)) x","decl":"theorem contMDiffAt_extChartAt : ContMDiffAt I ğ“˜(ğ•œ, E) n (extChartAt I x) x :=\n  contMDiffAt_extChartAt' <| mem_chart_source H x\n\n"}
{"name":"contMDiffOn_extChartAt","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\nx : M\nâŠ¢ ContMDiffOn I (modelWithCornersSelf ğ•œ E) n (â†‘(extChartAt I x)) (chartAt H x).source","decl":"theorem contMDiffOn_extChartAt : ContMDiffOn I ğ“˜(ğ•œ, E) n (extChartAt I x) (chartAt H x).source :=\n  fun _x' hx' => (contMDiffAt_extChartAt' hx').contMDiffWithinAt\n\n"}
{"name":"contMDiffOn_extend_symm","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\ne : PartialHomeomorph M H\nhe : Membership.mem (IsManifold.maximalAtlas I n M) e\nâŠ¢ ContMDiffOn (modelWithCornersSelf ğ•œ E) I n (â†‘(e.extend I).symm) (Set.image (â†‘I) e.target)","decl":"theorem contMDiffOn_extend_symm (he : e âˆˆ maximalAtlas I n M) :\n    ContMDiffOn ğ“˜(ğ•œ, E) I n (e.extend I).symm (I '' e.target) := by\n  refine (contMDiffOn_symm_of_mem_maximalAtlas he).comp\n    (contMDiffOn_model_symm.mono <| image_subset_range _ _) ?_\n  simp_rw [image_subset_iff, PartialEquiv.restr_coe_symm, I.toPartialEquiv_coe_symm,\n    preimage_preimage, I.left_inv, preimage_id']; rfl\n\n"}
{"name":"contMDiffOn_extChartAt_symm","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\nx : M\nâŠ¢ ContMDiffOn (modelWithCornersSelf ğ•œ E) I n (â†‘(extChartAt I x).symm) (extChartAt I x).target","decl":"theorem contMDiffOn_extChartAt_symm (x : M) :\n    ContMDiffOn ğ“˜(ğ•œ, E) I n (extChartAt I x).symm (extChartAt I x).target := by\n  convert contMDiffOn_extend_symm (chart_mem_maximalAtlas (I := I) x)\n  Â· rw [extChartAt_target, I.image_eq]\n  Â· infer_instance\n  Â· infer_instance\n\n"}
{"name":"contMDiffWithinAt_extChartAt_symm_target","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\nx : M\ny : E\nhy : Membership.mem (extChartAt I x).target y\nâŠ¢ ContMDiffWithinAt (modelWithCornersSelf ğ•œ E) I n (â†‘(extChartAt I x).symm) (extChartAt I x).target y","decl":"theorem contMDiffWithinAt_extChartAt_symm_target\n    (x : M) {y : E} (hy : y âˆˆ (extChartAt I x).target) :\n    ContMDiffWithinAt ğ“˜(ğ•œ, E) I n (extChartAt I x).symm (extChartAt I x).target y :=\n  contMDiffOn_extChartAt_symm x y hy\n\n"}
{"name":"contMDiffWithinAt_extChartAt_symm_range","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¶ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâµ : NormedAddCommGroup E\ninstâœâ´ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœÂ³ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœÂ² : TopologicalSpace M\ninstâœÂ¹ : ChartedSpace H M\nn : WithTop ENat\ninstâœ : IsManifold I n M\nx : M\ny : E\nhy : Membership.mem (extChartAt I x).target y\nâŠ¢ ContMDiffWithinAt (modelWithCornersSelf ğ•œ E) I n (â†‘(extChartAt I x).symm) (Set.range â†‘I) y","decl":"theorem contMDiffWithinAt_extChartAt_symm_range\n    (x : M) {y : E} (hy : y âˆˆ (extChartAt I x).target) :\n    ContMDiffWithinAt ğ“˜(ğ•œ, E) I n (extChartAt I x).symm (range I) y :=\n  (contMDiffWithinAt_extChartAt_symm_target x hy).mono_of_mem_nhdsWithin\n    (extChartAt_target_mem_nhdsWithin_of_mem hy)\n\n"}
{"name":"contMDiffOn_of_mem_contDiffGroupoid","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœÂ³ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœÂ² : NormedAddCommGroup E\ninstâœÂ¹ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nn : WithTop ENat\ne' : PartialHomeomorph H H\nh : Membership.mem (contDiffGroupoid n I) e'\nâŠ¢ ContMDiffOn I I n (â†‘e') e'.source","decl":"/-- An element of `contDiffGroupoid n I` is `C^n`. -/\ntheorem contMDiffOn_of_mem_contDiffGroupoid {e' : PartialHomeomorph H H}\n    (h : e' âˆˆ contDiffGroupoid n I) : ContMDiffOn I I n e' e'.source :=\n  (contDiffWithinAt_localInvariantProp n).liftPropOn_of_mem_groupoid contDiffWithinAtProp_id h\n\n"}
{"name":"isLocalStructomorphOn_contDiffGroupoid_iff_aux","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¸ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâ· : NormedAddCommGroup E\ninstâœâ¶ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœâµ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœâ´ : TopologicalSpace M\ninstâœÂ³ : ChartedSpace H M\nn : WithTop ENat\ninstâœÂ² : IsManifold I n M\nM' : Type u_5\ninstâœÂ¹ : TopologicalSpace M'\ninstâœ : ChartedSpace H M'\nIsM' : IsManifold I n M'\nf : PartialHomeomorph M M'\nhf : ChartedSpace.LiftPropOn (contDiffGroupoid n I).IsLocalStructomorphWithinAt (â†‘f) f.source\nâŠ¢ ContMDiffOn I I n (â†‘f) f.source","decl":"theorem isLocalStructomorphOn_contDiffGroupoid_iff_aux {f : PartialHomeomorph M M'}\n    (hf : LiftPropOn (contDiffGroupoid n I).IsLocalStructomorphWithinAt f f.source) :\n    ContMDiffOn I I n f f.source := by\n  -- It suffices to show regularity near each `x`\n  apply contMDiffOn_of_locally_contMDiffOn\n  intro x hx\n  let c := chartAt H x\n  let c' := chartAt H (f x)\n  obtain âŸ¨-, hxfâŸ© := hf x hx\n  -- Since `f` is a local structomorph, it is locally equal to some transferred element `e` of\n  -- the `contDiffGroupoid`.\n  obtain\n    âŸ¨e, he, he' : EqOn (c' âˆ˜ f âˆ˜ c.symm) e (c.symm â»Â¹' f.source âˆ© e.source), hex :\n      c x âˆˆ e.sourceâŸ© :=\n    hxf (by simp only [hx, mfld_simps])\n  -- We choose a convenient set `s` in `M`.\n  let s : Set M := (f.trans c').source âˆ© ((c.trans e).trans c'.symm).source\n  refine âŸ¨s, (f.trans c').open_source.inter ((c.trans e).trans c'.symm).open_source, ?_, ?_âŸ©\n  Â· simp only [s, mfld_simps]\n    rw [â† he'] <;> simp only [c, c', hx, hex, mfld_simps]\n  -- We need to show `f` is `ContMDiffOn` the domain `s âˆ© f.source`.  We show this in two\n  -- steps: `f` is equal to `c'.symm âˆ˜ e âˆ˜ c` on that domain and that function is\n  -- `ContMDiffOn` it.\n  have Hâ‚ : ContMDiffOn I I n (c'.symm âˆ˜ e âˆ˜ c) s := by\n    have hc' : ContMDiffOn I I n c'.symm _ := contMDiffOn_chart_symm\n    have he'' : ContMDiffOn I I n e _ := contMDiffOn_of_mem_contDiffGroupoid he\n    have hc : ContMDiffOn I I n c _ := contMDiffOn_chart\n    refine (hc'.comp' (he''.comp' hc)).mono ?_\n    dsimp [s, c, c']\n    mfld_set_tac\n  have Hâ‚‚ : EqOn f (c'.symm âˆ˜ e âˆ˜ c) s := by\n    intro y hy\n    simp only [s, mfld_simps] at hy\n    have hyâ‚ : f y âˆˆ c'.source := by simp only [hy, mfld_simps]\n    have hyâ‚‚ : y âˆˆ c.source := by simp only [hy, mfld_simps]\n    have hyâ‚ƒ : c y âˆˆ c.symm â»Â¹' f.source âˆ© e.source := by simp only [hy, mfld_simps]\n    calc\n      f y = c'.symm (c' (f y)) := by rw [c'.left_inv hyâ‚]\n      _ = c'.symm (c' (f (c.symm (c y)))) := by rw [c.left_inv hyâ‚‚]\n      _ = c'.symm (e (c y)) := by rw [â† he' hyâ‚ƒ]; rfl\n  refine (Hâ‚.congr Hâ‚‚).mono ?_\n  mfld_set_tac\n\n"}
{"name":"isLocalStructomorphOn_contDiffGroupoid_iff","module":"Mathlib.Geometry.Manifold.ContMDiff.Atlas","initialProofState":"ğ•œ : Type u_1\ninstâœâ¸ : NontriviallyNormedField ğ•œ\nE : Type u_2\ninstâœâ· : NormedAddCommGroup E\ninstâœâ¶ : NormedSpace ğ•œ E\nH : Type u_3\ninstâœâµ : TopologicalSpace H\nI : ModelWithCorners ğ•œ E H\nM : Type u_4\ninstâœâ´ : TopologicalSpace M\ninstâœÂ³ : ChartedSpace H M\nn : WithTop ENat\ninstâœÂ² : IsManifold I n M\nM' : Type u_5\ninstâœÂ¹ : TopologicalSpace M'\ninstâœ : ChartedSpace H M'\nIsM' : IsManifold I n M'\nf : PartialHomeomorph M M'\nâŠ¢ Iff (ChartedSpace.LiftPropOn (contDiffGroupoid n I).IsLocalStructomorphWithinAt (â†‘f) f.source) (And (ContMDiffOn I I n (â†‘f) f.source) (ContMDiffOn I I n (â†‘f.symm) f.target))","decl":"/-- Let `M` and `M'` be manifolds with the same model-with-corners, `I`.  Then `f : M â†’ M'`\nis a local structomorphism for `I`, if and only if it is manifold-`C^n` on the domain of definition\nin both directions. -/\ntheorem isLocalStructomorphOn_contDiffGroupoid_iff (f : PartialHomeomorph M M') :\n    LiftPropOn (contDiffGroupoid n I).IsLocalStructomorphWithinAt f f.source â†”\n      ContMDiffOn I I n f f.source âˆ§ ContMDiffOn I I n f.symm f.target := by\n  constructor\n  Â· intro h\n    refine âŸ¨isLocalStructomorphOn_contDiffGroupoid_iff_aux h,\n      isLocalStructomorphOn_contDiffGroupoid_iff_aux ?_âŸ©\n    -- todo: we can generalize this part of the proof to a lemma\n    intro X hX\n    let x := f.symm X\n    have hx : x âˆˆ f.source := f.symm.mapsTo hX\n    let c := chartAt H x\n    let c' := chartAt H X\n    obtain âŸ¨-, hxfâŸ© := h x hx\n    refine âŸ¨(f.symm.continuousAt hX).continuousWithinAt, fun h2x => ?_âŸ©\n    obtain âŸ¨e, he, h2e, hef, hexâŸ© :\n      âˆƒ e : PartialHomeomorph H H,\n        e âˆˆ contDiffGroupoid n I âˆ§\n          e.source âŠ† (c.symm â‰«â‚• f â‰«â‚• c').source âˆ§\n            EqOn (c' âˆ˜ f âˆ˜ c.symm) e e.source âˆ§ c x âˆˆ e.source := by\n      have h1 : c' = chartAt H (f x) := by simp only [x, c', f.right_inv hX]\n      have h2 : c' âˆ˜ f âˆ˜ c.symm = â‡‘(c.symm â‰«â‚• f â‰«â‚• c') := rfl\n      have hcx : c x âˆˆ c.symm â»Â¹' f.source := by simp only [c, hx, mfld_simps]\n      rw [h2]\n      rw [â† h1, h2, PartialHomeomorph.isLocalStructomorphWithinAt_iff'] at hxf\n      Â· exact hxf hcx\n      Â· dsimp [x, c]; mfld_set_tac\n      Â· apply Or.inl\n        simp only [c, hx, h1, mfld_simps]\n    have h2X : c' X = e (c (f.symm X)) := by\n      rw [â† hef hex]\n      dsimp only [Function.comp_def]\n      have hfX : f.symm X âˆˆ c.source := by simp only [c, x, hX, mfld_simps]\n      rw [c.left_inv hfX, f.right_inv hX]\n    have h3e : EqOn (c âˆ˜ f.symm âˆ˜ c'.symm) e.symm (c'.symm â»Â¹' f.target âˆ© e.target) := by\n      have h1 : EqOn (c.symm â‰«â‚• f â‰«â‚• c').symm e.symm (e.target âˆ© e.target) := by\n        apply EqOn.symm\n        refine e.isImage_source_target.symm_eqOn_of_inter_eq_of_eqOn ?_ ?_\n        Â· rw [inter_self, inter_eq_right.mpr h2e]\n        Â· rw [inter_self]; exact hef.symm\n      have h2 : e.target âŠ† (c.symm â‰«â‚• f â‰«â‚• c').target := by\n        intro x hx; rw [â† e.right_inv hx, â† hef (e.symm.mapsTo hx)]\n        exact PartialHomeomorph.mapsTo _ (h2e <| e.symm.mapsTo hx)\n      rw [inter_self] at h1\n      rwa [inter_eq_right.mpr]\n      refine h2.trans ?_\n      mfld_set_tac\n    refine âŸ¨e.symm, StructureGroupoid.symm _ he, h3e, ?_âŸ©\n    rw [h2X]; exact e.mapsTo hex\n  Â· -- We now show the converse: a partial homeomorphism `f : M â†’ M'` which is `C^n` in both\n    -- directions is a local structomorphism.  We do this by proposing\n    -- `((chart_at H x).symm.trans f).trans (chart_at H (f x))` as a candidate for a structomorphism\n    -- of `H`.\n    rintro âŸ¨hâ‚, hâ‚‚âŸ© x hx\n    refine âŸ¨(hâ‚ x hx).continuousWithinAt, ?_âŸ©\n    let c := chartAt H x\n    let c' := chartAt H (f x)\n    rintro (hx' : c x âˆˆ c.symm â»Â¹' f.source)\n    -- propose `(c.symm.trans f).trans c'` as a candidate for a local structomorphism of `H`\n    refine âŸ¨(c.symm.trans f).trans c', âŸ¨?_, ?_âŸ©, (?_ : EqOn (c' âˆ˜ f âˆ˜ c.symm) _ _), ?_âŸ©\n    Â· -- regularity of the candidate local structomorphism in the forward direction\n      intro y hy\n      simp only [mfld_simps] at hy\n      have H : ContMDiffWithinAt I I n f (f â‰«â‚• c').source ((extChartAt I x).symm y) := by\n        refine (hâ‚ ((extChartAt I x).symm y) ?_).mono ?_\n        Â· simp only [c, hy, mfld_simps]\n        Â· mfld_set_tac\n      have hy' : (extChartAt I x).symm y âˆˆ c.source := by simp only [c, hy, mfld_simps]\n      have hy'' : f ((extChartAt I x).symm y) âˆˆ c'.source := by\n        simp only [c, hy, mfld_simps]\n      rw [contMDiffWithinAt_iff_of_mem_source hy' hy''] at H\n      convert H.2.mono _\n      Â· simp only [c, hy, mfld_simps]\n      Â· dsimp [c, c']; mfld_set_tac\n    Â· -- regularity of the candidate local structomorphism in the reverse direction\n      intro y hy\n      simp only [mfld_simps] at hy\n      have H : ContMDiffWithinAt I I n f.symm (f.symm â‰«â‚• c).source\n          ((extChartAt I (f x)).symm y) := by\n        refine (hâ‚‚ ((extChartAt I (f x)).symm y) ?_).mono ?_\n        Â· simp only [c', hy, mfld_simps]\n        Â· mfld_set_tac\n      have hy' : (extChartAt I (f x)).symm y âˆˆ c'.source := by simp only [c', hy, mfld_simps]\n      have hy'' : f.symm ((extChartAt I (f x)).symm y) âˆˆ c.source := by\n        simp only [c', hy, mfld_simps]\n      rw [contMDiffWithinAt_iff_of_mem_source hy' hy''] at H\n      convert H.2.mono _\n      Â· simp only [c', hy, mfld_simps]\n      Â· dsimp [c, c']; mfld_set_tac\n    -- now check the candidate local structomorphism agrees with `f` where it is supposed to\n    Â· simp only [mfld_simps]; apply eqOn_refl\n    Â· simp only [c, c', hx', mfld_simps]\n\n"}
